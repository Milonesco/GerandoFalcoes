@model Transformese.MVC.ViewModels.CandidatoInscricaoViewModel

@{
    ViewData["Title"] = "Ficha de Inscrição";
    ViewData["HideNavMenu"] = true;
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <script>
        $(document).ready(function () {
            // Máscaras
            $('#CPF').mask('000.000.000-00');
            $('#Telefone').mask('(00) 00000-0000');
            $('#Cep').mask('00000-000');
            $('#RendaFamiliar').mask('000.000.000,00', {reverse: true});

            // Tratamento da Renda antes de enviar
            $('#wizard-form').submit(function() {
                var campoRenda = $('#RendaFamiliar');
                if(campoRenda.val()) {
                    var valorLimpo = campoRenda.val().replace(/\./g, '').replace(',', '.');
                    campoRenda.val(valorLimpo);
                }
            });
        });

        // Lógica do Wizard
        let currentStep = 1;
        const totalSteps = 4;

        function changeStep(n) {
            if (n === 1 && !validateStep(currentStep)) return;
            document.getElementById(`step-${currentStep}`).classList.add('d-none');
            currentStep += n;
            document.getElementById(`step-${currentStep}`).classList.remove('d-none');
            updateUI();
        }

        function validateStep(step) {
            const container = document.getElementById(`step-${step}`);
            const inputs = container.querySelectorAll('input:not([type="hidden"]), select');
            let valid = true;

            inputs.forEach(input => {
                if (!input.hasAttribute('required') && input.value === '') return;
                if (!input.checkValidity()) {
                    input.classList.add('is-invalid');
                    valid = false;
                } else {
                    input.classList.remove('is-invalid');
                }
            });

            if (!valid) container.closest('form').reportValidity();
            return valid;
        }

        function updateUI() {
            const percentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progress-bar-fill').style.width = `${percentage}%`;

            const titles = ["Dados Pessoais", "Contato", "Perfil Socioeconômico", "Carreira & Termos"];
            document.getElementById('step-title').innerText = `Passo ${currentStep}: ${titles[currentStep-1]}`;
            document.getElementById('step-count').innerText = `${currentStep}/${totalSteps}`;

            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            const btnSubmit = document.getElementById('btn-submit');

            currentStep === 1 ? btnPrev.classList.add('d-none') : btnPrev.classList.remove('d-none');

            if (currentStep === totalSteps) {
                btnNext.classList.add('d-none');
                btnSubmit.classList.remove('d-none');
            } else {
                btnNext.classList.remove('d-none');
                btnSubmit.classList.add('d-none');
            }

            document.getElementById('form-top').scrollIntoView({ behavior: 'smooth' });
        }

        // ViaCEP
        function buscarCep(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length === 8) {
                document.getElementById('Cidade').value = "...";
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(r => r.json())
                    .then(d => {
                        if (!d.erro) {
                            document.getElementById('Cidade').value = d.localidade;
                            document.getElementById('Estado').value = d.uf;
                        } else alert("CEP não encontrado.");
                    })
                    .catch(() => {
                        alert("Erro ao buscar CEP.");
                        document.getElementById('Cidade').value = "";
                        document.getElementById('Estado').value = "";
                    });
            }
        }

        function toggleDeficienciaDescricao() {
            const checkbox = document.getElementById('PossuiDeficiencia');
            const descricaoContainer = document.getElementById('descricao-deficiencia-container');
            const descricaoInput = document.getElementById('DescricaoDeficiencia');

            if (checkbox.checked) {
                descricaoContainer.classList.remove('d-none');
                descricaoInput.setAttribute('required', 'required');
            } else {
                descricaoContainer.classList.add('d-none');
                descricaoInput.removeAttribute('required');
                descricaoInput.value = '';
            }
        }
    </script>
}

<div class="container py-5" id="form-top">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-5">
                <h2 class="fw-bold display-6">Transforme-se 🚀</h2>
                <p class="text-muted">Inscrição para Processo Seletivo</p>
            </div>

            <div class="card shadow rounded-4 overflow-hidden">
                <div class="bg-light p-4 border-bottom">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-bold text-uppercase small text-muted" id="step-title">Passo 1</span>
                        <span class="fw-bold small text-muted" id="step-count">1/4</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div id="progress-bar-fill" class="progress-bar bg-success" style="width: 0%; transition: 0.4s;"></div>
                    </div>
                </div>

                <div class="card-body p-4 p-md-5">
                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="alert alert-danger rounded-3 mb-4">
                            <i class="bi bi-exclamation-octagon-fill me-2"></i> Verifique os erros abaixo:
                            <div asp-validation-summary="All" class="small mt-2"></div>
                        </div>
                    }

                    <form asp-action="Criar" method="post" id="wizard-form">

                        <!-- PASSO 1: Dados Pessoais -->
                        <div id="step-1" class="step-content">
                            <h5 class="mb-4 fw-bold text-success">Quem é você?</h5>

                            <div class="mb-3">
                                <label asp-for="NomeCompleto" class="form-label fw-semibold">Nome Completo</label>
                                <input asp-for="NomeCompleto" class="form-control form-control-lg" placeholder="Seu nome" required />
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label asp-for="CPF" class="form-label fw-semibold">CPF</label>
                                    <input asp-for="CPF" id="CPF" class="form-control" placeholder="000.000.000-00" required />
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="DataNascimento" class="form-label fw-semibold">Nascimento</label>
                                    <input asp-for="DataNascimento" type="date" class="form-control" required />
                                </div>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label asp-for="IdentidadeGenero" class="form-label fw-semibold">Gênero</label>
                                    <select asp-for="IdentidadeGenero" class="form-select">
                                        <option value="">Selecione...</option>
                                        <option value="Mulher Cisgênero">Mulher Cisgênero</option>
                                        <option value="Homem Cisgênero">Homem Cisgênero</option>
                                        <option value="Mulher Transgênero">Mulher Transgênero</option>
                                        <option value="Homem Transgênero">Homem Transgênero</option>
                                        <option value="Não-binário">Não-binário</option>
                                        <option value="Prefiro não responder">Prefiro não responder</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="RacaCor" class="form-label fw-semibold">Raça/Cor</label>
                                    <select asp-for="RacaCor" class="form-select">
                                        <option value="">Selecione...</option>
                                        <option value="Branca">Branca</option>
                                        <option value="Preta">Preta</option>
                                        <option value="Parda">Parda</option>
                                        <option value="Amarela">Amarela</option>
                                        <option value="Indígena">Indígena</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label asp-for="OrientacaoSexual" class="form-label fw-semibold">Orientação Sexual</label>
                                    <select asp-for="OrientacaoSexual" class="form-select">
                                        <option value="">Selecione...</option>
                                        <option value="Heterossexual">Heterossexual</option>
                                        <option value="Homossexual">Homossexual</option>
                                        <option value="Bissexual">Bissexual</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="Deficiencia" class="form-label fw-semibold">Possui Deficiência?</label>
                                    <input asp-for="Deficiencia" class="form-control" placeholder="Se sim, qual?" />
                                </div>
                            </div>
                        </div>

                        <div id="step-2" class="step-content d-none">
                            <h5 class="mb-4 fw-bold text-success">Contato</h5>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label asp-for="Email" class="form-label fw-semibold">E-mail</label>
                                    <input asp-for="Email" type="email" class="form-control" required />
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="Telefone" class="form-label fw-semibold">Celular</label>
                                    <input asp-for="Telefone" id="Telefone" class="form-control" required />
                                </div>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label asp-for="CEP" class="form-label fw-semibold">CEP</label>
                                    <input asp-for="CEP" id="Cep" class="form-control" onblur="buscarCep(this.value)" />
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="Cidade" class="form-label fw-semibold">Cidade</label>
                                    <input asp-for="Cidade" id="Cidade" class="form-control" required />
                                </div>
                                <div class="col-md-2">
                                    <label asp-for="Estado" class="form-label fw-semibold">UF</label>
                                    <select asp-for="Estado" id="Estado" class="form-select" required>
                                        <option value="">UF</option>
                                        <option value="SP">SP</option>
                                        <option value="RJ">RJ</option>
                                        <option value="MG">MG</option>
                                        <option value="RS">RS</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- PASSO 4: Situação Socioeconômica -->
                        <div id="step-4" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Situação Socioeconômica</h4>

                            <div class="mb-4">
                                <label asp-for="Escolaridade" class="form-label fw-semibold inscription-label">Escolaridade</label>
                                <select asp-for="Escolaridade" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione sua escolaridade</option>
                                    <option value="FundamentalIncompleto">Ensino Fundamental Incompleto</option>
                                    <option value="FundamentalCompleto">Ensino Fundamental Completo</option>
                                    <option value="MedioIncompleto">Ensino Médio Incompleto</option>
                                    <option value="MedioCompleto">Ensino Médio Completo</option>
                                    <option value="SuperiorIncompleto">Ensino Superior Incompleto</option>
                                    <option value="SuperiorCompleto">Ensino Superior Completo</option>
                                    <option value="PosGraduacao">Pós-graduação</option>
                                </select>
                                <span asp-validation-for="Escolaridade" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="TrabalhaAtualmente" class="form-check-input" type="checkbox" id="TrabalhaAtualmente">
                                    <label class="form-check-label inscription-label" for="TrabalhaAtualmente">
                                        Trabalho atualmente
                                    </label>
                                </div>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label asp-for="RendaFamiliar" class="form-label fw-semibold inscription-label">Renda Familiar Mensal</label>
                                    <select asp-for="RendaFamiliar" class="form-select form-select-lg" required>
                                        <option value="" selected disabled>Selecione</option>
                                        <option value="Ate1Salario">Até 1 salário mínimo</option>
                                        <option value="De1a2Salarios">De 1 a 2 salários mínimos</option>
                                        <option value="De2a3Salarios">De 2 a 3 salários mínimos</option>
                                        <option value="De3a5Salarios">De 3 a 5 salários mínimos</option>
                                        <option value="Acima5Salarios">Acima de 5 salários mínimos</option>
                                    </select>
                                    <span asp-validation-for="RendaFamiliar" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="PessoasNoDomicilio" class="form-label fw-semibold inscription-label">Pessoas no Domicílio</label>
                                    <select asp-for="PessoasNoDomicilio" class="form-select form-select-lg" required>
                                        <option value="" selected disabled>Selecione</option>
                                        <option value="1">1 pessoa</option>
                                        <option value="2">2-3 pessoas</option>
                                        <option value="4">4-5 pessoas</option>
                                        <option value="6">5+ pessoas</option>
                                    </select>
                                    <span asp-validation-for="PessoasNoDomicilio" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="PossuiDeficiencia" class="form-check-input" type="checkbox" id="PossuiDeficiencia" onchange="toggleDeficienciaDescricao()">
                                    <label class="form-check-label inscription-label" for="PossuiDeficiencia">
                                        Possuo alguma deficiência
                                    </label>
                                </div>
                            </div>

                            <div id="descricao-deficiencia-container" class="mb-4 d-none">
                                <label asp-for="DescricaoDeficiencia" class="form-label fw-semibold inscription-label">Qual deficiência?</label>
                                <textarea asp-for="DescricaoDeficiencia" class="form-control" rows="3" placeholder="Descreva brevemente sua deficiência"></textarea>
                                <span asp-validation-for="DescricaoDeficiencia" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- PASSO 5: Curso & Disponibilidade -->
                        <div id="step-5" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Sobre o Curso</h4>

                            <div class="mb-4">
                                <label asp-for="CursoDesejado" class="form-label fw-semibold inscription-label">Curso Desejado</label>
                                <select asp-for="CursoDesejado" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione o curso de interesse</option>
                                    <option value="ProgramadorDeSistemas">Programador de Sistemas</option>
                                    <option value="AssistenteDeTI">Assistente de TI (Zona Oeste)</option>
                                </select>
                                <span asp-validation-for="CursoDesejado" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <label asp-for="TurnoPreferencial" class="form-label fw-semibold inscription-label">Turno Preferencial</label>
                                <select asp-for="TurnoPreferencial" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione</option>
                                    <option value="Tarde">Tarde</option>
                                    <option value="Noite">Noite</option>
                                </select>
                                <span asp-validation-for="TurnoPreferencial" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="JaEstudouAntes" class="form-check-input" type="checkbox" id="JaEstudouAntes">
                                    <label class="form-check-label inscription-label" for="JaEstudouAntes">
                                        Já estudei essa área antes
                                    </label>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="IndicadoPor" class="form-label fw-semibold inscription-label">Como conheceu o programa? (Opcional)</label>
                                <select asp-for="IndicadoPor" class="form-select form-select-lg" data-optional>
                                    <option value="">Selecione</option>
                                    <option value="Instagram">Instagram</option>
                                    <option value="Facebook">Facebook</option>
                                    <option value="WhatsApp">WhatsApp</option>
                                    <option value="Amigo">Indicação de amigo/familiar</option>
                                    <option value="Escola">Escola/Universidade</option>
                                    <option value="Google">Busca no Google</option>
                                    <option value="GerandoFalcoes">Site Gerando Falcões</option>
                                    <option value="Outro">Outro</option>
                                </select>
                                <span asp-validation-for="IndicadoPor" class="text-danger small"></span>
                            </div>
                        </div>

                        <div id="step-3" class="step-content d-none">
                            <h5 class="mb-4 fw-bold text-success">Perfil socioeconomico & estrutura</h5>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label asp-for="Escolaridade" class="form-label fw-semibold">Escolaridade</label>
                                    <select asp-for="Escolaridade" class="form-select" required>
                                        <option value="">Selecione...</option>
                                        <option value="Ensino Fundamental">Ensino Fundamental</option>
                                        <option value="Ensino Médio Incompleto">Ensino Médio Incompleto</option>
                                        <option value="Ensino Médio Completo">Ensino Médio Completo</option>
                                        <option value="Superior Incompleto">Superior Incompleto</option>
                                        <option value="Superior Completo">Superior Completo</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="PessoasNaCasa" class="form-label fw-semibold">Pessoas na Casa</label>
                                    <input asp-for="PessoasNaCasa" type="number" class="form-control" min="1" required />
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="RendaFamiliar" class="form-label fw-semibold">Renda Familiar (R$)</label>
                                <input asp-for="RendaFamiliar" id="RendaFamiliar" class="form-control form-control-lg" placeholder="Ex: 1.500,00" />
                            </div>

                            <div class="card bg-light border-0 mb-3">
                                <div class="card-body">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" role="switch" asp-for="TrabalhaAtualmente">
                                        <label class="form-check-label fw-semibold ms-2" asp-for="TrabalhaAtualmente">Eu trabalho atualmente</label>
                                    </div>

                                    <hr class="text-muted">

                                    <label class="form-label fw-bold d-block mb-2 text-muted small">INFRAESTRUTURA</label>
                                    <div class="d-flex flex-column flex-md-row gap-md-4">
                                        <div class="form-check form-switch mb-2">
                                            <input class="form-check-input" type="checkbox" role="switch" asp-for="PossuiComputador">
                                            <label class="form-check-label ms-2" asp-for="PossuiComputador">Tenho Computador</label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" asp-for="PossuiInternet">
                                            <label class="form-check-label ms-2" asp-for="PossuiInternet">Tenho Internet em casa</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="step-4" class="step-content d-none">
                            <h5 class="mb-4 fw-bold text-success">Carreira & Futuro</h5>

                            <div class="mb-3">
                                <label asp-for="CursoInteresse" class="form-label fw-semibold">Curso de Interesse</label>
                                <select asp-for="CursoInteresse" class="form-select form-select-lg" required>
                                    <option value="">Selecione...</option>
                                    <option value="Desenvolvimento Web Fullstack">Desenvolvimento Web Fullstack</option>
                                    <option value="Data Analytics">Data Analytics</option>
                                    <option value="Marketing Digital">Marketing Digital</option>
                                    <option value="Design UX/UI">Design UX/UI</option>
                                </select>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label asp-for="TurnoPreferido" class="form-label fw-semibold">Turno</label>
                                    <select asp-for="TurnoPreferido" class="form-select">
                                        <option value="Manhã">Manhã</option>
                                        <option value="Tarde">Tarde</option>
                                        <option value="Noite">Noite</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="NomeIndicacao" class="form-label fw-semibold">Indicação (Opcional)</label>
                                    <input asp-for="NomeIndicacao" class="form-control" placeholder="Quem indicou?" />
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="PerfilLinkedin" class="form-label fw-semibold">LinkedIn (Opcional)</label>
                                <input asp-for="PerfilLinkedin" class="form-control" placeholder="linkedin.com/in/voce" />
                            </div>

                            <div class="form-check form-switch mb-4">
                                <input class="form-check-input" type="checkbox" role="switch" asp-for="JaEstudouNaGF">
                                <label class="form-check-label fw-semibold ms-2" asp-for="JaEstudouNaGF">Já estudei na Gerando Falcões antes</label>
                            </div>

                            <div class="card border-success bg-white border-opacity-25 mb-3">
                                <div class="card-body">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" role="switch" asp-for="AceitouTermos" required>
                                        <label class="form-check-label small ms-2" asp-for="AceitouTermos">
                                            Li e aceito os <strong>Termos de Uso</strong> e declaro que as informações são verdadeiras.
                                        </label>
                                        <span asp-validation-for="AceitouTermos" class="text-danger d-block small mt-1"></span>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" asp-for="AceitouNovidades">
                                        <label class="form-check-label small ms-2" asp-for="AceitouNovidades">
                                            Aceito receber novidades por e-mail.
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-5">
                            <button type="button" id="btn-prev" class="btn btn-outline-secondary px-4 d-none" onclick="changeStep(-1)">Voltar</button>
                            <button type="button" id="btn-next" class="btn btn-dark px-5 ms-auto" onclick="changeStep(1)">Próximo</button>
                            <button type="submit" id="btn-submit" class="btn btn-success px-5 ms-auto d-none fw-bold">FINALIZAR</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>