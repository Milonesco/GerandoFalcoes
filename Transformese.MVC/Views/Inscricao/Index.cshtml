@model Transformese.MVC.ViewModels.CandidatoInscricaoViewModel

@{
    ViewData["Title"] = "Ficha de Inscrição";
    ViewData["HideNavMenu"] = true;
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#CPF').mask('000.000.000-00');
            $('#Telefone').mask('(00) 00000-0000');
            $('#CEP').mask('00000-000');
        });

        let currentStep = 1;
        const totalSteps = 6;

        function changeStep(n) {
            if (n === 1 && !validateStep(currentStep)) return;

            document.getElementById(`step-${currentStep}`).classList.add('d-none');
            currentStep += n;
            document.getElementById(`step-${currentStep}`).classList.remove('d-none');

            updateUI();
        }

        function validateStep(step) {
            const container = document.getElementById(`step-${step}`);
            const inputs = container.querySelectorAll('input:not([type="checkbox"]):not([type="radio"]), select');
            let valid = true;

            inputs.forEach(input => {
                // Pula validação de campos opcionais
                if (input.hasAttribute('data-optional')) return;

                if (!input.checkValidity()) {
                    input.classList.add('is-invalid');
                    valid = false;
                } else {
                    input.classList.remove('is-invalid');
                }
            });

            // Validação especial para campos condicionais
            if (step === 4) {
                const possuiDeficiencia = document.getElementById('PossuiDeficiencia').checked;
                const descricaoDeficiencia = document.getElementById('DescricaoDeficiencia');
                if (possuiDeficiencia && !descricaoDeficiencia.value.trim()) {
                    descricaoDeficiencia.classList.add('is-invalid');
                    valid = false;
                }
            }

            if (!valid) {
                container.closest('form').reportValidity();
            }
            return valid;
        }

        function updateUI() {
            const percentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            const progressBar = document.getElementById('progress-bar-fill');
            progressBar.style.width = `${percentage}%`;
            progressBar.setAttribute('aria-valuenow', percentage);

            const stepTitles = [
                "Dados Pessoais",
                "Identidade e Diversidade",
                "Contato & Localização",
                "Situação Socioeconômica",
                "Curso & Disponibilidade",
                "Conectividade & Finalização"
            ];
            document.getElementById('step-title').innerText = `Passo ${currentStep}: ${stepTitles[currentStep - 1]}`;

            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');
            const btnSubmit = document.getElementById('btn-submit');

            if (currentStep === 1) btnPrev.classList.add('d-none');
            else btnPrev.classList.remove('d-none');

            if (currentStep === totalSteps) {
                btnNext.classList.add('d-none');
                btnSubmit.classList.remove('d-none');
            } else {
                btnNext.classList.remove('d-none');
                btnSubmit.classList.add('d-none');
            }

            document.getElementById('form-top').scrollIntoView({ behavior: 'smooth' });
        }

        function buscarCep(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length === 8) {
                document.getElementById('Cidade').value = "...";
                document.getElementById('Estado').value = "...";

                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('Cidade').value = data.localidade;
                            document.getElementById('Estado').value = data.uf;
                        } else {
                            alert("CEP não encontrado.");
                            document.getElementById('Cidade').value = "";
                            document.getElementById('Estado').value = "";
                        }
                    })
                    .catch(() => {
                        alert("Erro ao buscar CEP.");
                        document.getElementById('Cidade').value = "";
                        document.getElementById('Estado').value = "";
                    });
            }
        }

        function toggleDeficienciaDescricao() {
            const checkbox = document.getElementById('PossuiDeficiencia');
            const descricaoContainer = document.getElementById('descricao-deficiencia-container');
            const descricaoInput = document.getElementById('DescricaoDeficiencia');

            if (checkbox.checked) {
                descricaoContainer.classList.remove('d-none');
                descricaoInput.setAttribute('required', 'required');
            } else {
                descricaoContainer.classList.add('d-none');
                descricaoInput.removeAttribute('required');
                descricaoInput.value = '';
            }
        }
    </script>
}

<div class="container py-5" id="form-top">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <div class="text-center mb-5">
                <h2 class="fw-bold display-6 inscription-title">Vamos começar sua jornada 🚀</h2>
                <p class="text-muted">Preencha os dados abaixo para se candidatar às bolsas do Transformese.</p>
            </div>

            <div class="card inscription-card shadow-lg border-0 rounded-4 overflow-hidden">

                <div class="inscription-card-header p-4 border-bottom">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-bold text-uppercase small inscription-step-text" id="step-title">Passo 1: Dados Pessoais</span>
                        <span class="fw-bold small inscription-step-text" id="step-count"></span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div id="progress-bar-fill" class="progress-bar inscription-progress-bar" role="progressbar" style="width: 0%; transition: width 0.5s ease;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>

                <div class="card-body inscription-card-body p-4 p-md-5">

                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="alert alert-danger rounded-3 mb-4">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i> Ocorreu um erro no envio. Verifique os dados abaixo.
                            <div asp-validation-summary="All" class="small mt-2"></div>
                        </div>
                    }

                    <form asp-action="Criar" method="post" id="wizard-form">

                        <!-- PASSO 1: Dados Pessoais -->
                        <div id="step-1" class="step-content">
                            <h4 class="mb-4 fw-bold inscription-step-title">Quem é você?</h4>

                            <div class="mb-4">
                                <label asp-for="NomeCompleto" class="form-label fw-semibold inscription-label">Nome Completo</label>
                                <input asp-for="NomeCompleto" class="form-control form-control-lg" placeholder="Digite seu nome completo" required />
                                <span asp-validation-for="NomeCompleto" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <label asp-for="NomeSocial" class="form-label fw-semibold inscription-label">Nome Social (Opcional)</label>
                                <input asp-for="NomeSocial" class="form-control form-control-lg" placeholder="Se você usa um nome social, informe aqui" data-optional />
                                <span asp-validation-for="NomeSocial" class="text-danger small"></span>
                                <small class="form-text text-muted">Campo opcional - preencha apenas se desejar.</small>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label asp-for="CPF" class="form-label fw-semibold inscription-label">CPF</label>
                                    <input asp-for="CPF" class="form-control form-control-lg" placeholder="000.000.000-00" required />
                                    <span asp-validation-for="CPF" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="DataNascimento" class="form-label fw-semibold inscription-label">Data de Nascimento</label>
                                    <input asp-for="DataNascimento" type="date" class="form-control form-control-lg" required />
                                    <span asp-validation-for="DataNascimento" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- PASSO 2: Identidade e Diversidade -->
                        <div id="step-2" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Sua Identidade</h4>
                            <p class="text-muted mb-4">Essas informações nos ajudam a promover diversidade e inclusão no programa.</p>

                            <div class="mb-4">
                                <label asp-for="RaçaEtnia" class="form-label fw-semibold inscription-label">Raça/Etnia</label>
                                <select asp-for="RaçaEtnia" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione</option>
                                    <option value="Branca">Branca</option>
                                    <option value="Preta">Preta</option>
                                    <option value="Parda">Parda</option>
                                    <option value="Amarela">Amarela</option>
                                    <option value="Indígena">Indígena</option>
                                    <option value="PreferNaoInformar">Prefiro não informar</option>
                                </select>
                                <span asp-validation-for="RaçaEtnia" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <label asp-for="IdentidadeGenero" class="form-label fw-semibold inscription-label">Identidade de Gênero</label>
                                <select asp-for="IdentidadeGenero" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione sua identidade de gênero</option>
                                    <option value="Feminino">Feminino</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="NaoBinario">Não-binário</option>
                                    <option value="Outro">Outro</option>
                                    <option value="PreferNaoInformar">Prefiro não informar</option>
                                </select>
                                <span asp-validation-for="IdentidadeGenero" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="PessoaTransgenero" class="form-check-input" type="checkbox" id="PessoaTransgenero">
                                    <label class="form-check-label inscription-label" for="PessoaTransgenero">
                                        Sou uma pessoa transgênero
                                    </label>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="OrientacaoSexual" class="form-label fw-semibold inscription-label">Orientação Sexual</label>
                                <select asp-for="OrientacaoSexual" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione</option>
                                    <option value="Heterossexual">Heterossexual</option>
                                    <option value="Homossexual">Homossexual</option>
                                    <option value="Bissexual">Bissexual</option>
                                    <option value="Pansexual">Pansexual</option>
                                    <option value="Assexual">Assexual</option>
                                    <option value="Outra">Outra</option>
                                    <option value="PreferNaoInformar">Prefiro não informar</option>
                                </select>
                                <span asp-validation-for="OrientacaoSexual" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- PASSO 3: Contato & Localização -->
                        <div id="step-3" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Como te encontramos?</h4>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label asp-for="Email" class="form-label fw-semibold inscription-label">E-mail Principal</label>
                                    <input asp-for="Email" type="email" class="form-control form-control-lg" placeholder="seu@email.com" required />
                                    <span asp-validation-for="Email" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="Telefone" class="form-label fw-semibold inscription-label">Celular / WhatsApp</label>
                                    <input asp-for="Telefone" class="form-control form-control-lg" placeholder="(00) 00000-0000" required />
                                    <span asp-validation-for="Telefone" class="text-danger small"></span>
                                </div>
                            </div>

                            <hr class="my-4 text-muted">

                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label asp-for="CEP" class="form-label fw-semibold inscription-label">CEP</label>
                                    <input asp-for="CEP" type="text" class="form-control form-control-lg" placeholder="00000-000" onblur="buscarCep(this.value)" required>
                                    <span asp-validation-for="CEP" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="Cidade" class="form-label fw-semibold inscription-label">Cidade</label>
                                    <input asp-for="Cidade" class="form-control form-control-lg" required />
                                    <span asp-validation-for="Cidade" class="text-danger small"></span>
                                </div>
                                <div class="col-md-2">
                                    <label asp-for="Estado" class="form-label fw-semibold inscription-label">UF</label>
                                    <input asp-for="Estado" class="form-control form-control-lg" maxlength="2" required />
                                    <span asp-validation-for="Estado" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- PASSO 4: Situação Socioeconômica -->
                        <div id="step-4" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Situação Socioeconômica</h4>

                            <div class="mb-4">
                                <label asp-for="Escolaridade" class="form-label fw-semibold inscription-label">Escolaridade</label>
                                <select asp-for="Escolaridade" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione sua escolaridade</option>
                                    <option value="FundamentalIncompleto">Ensino Fundamental Incompleto</option>
                                    <option value="FundamentalCompleto">Ensino Fundamental Completo</option>
                                    <option value="MedioIncompleto">Ensino Médio Incompleto</option>
                                    <option value="MedioCompleto">Ensino Médio Completo</option>
                                    <option value="SuperiorIncompleto">Ensino Superior Incompleto</option>
                                    <option value="SuperiorCompleto">Ensino Superior Completo</option>
                                    <option value="PosGraduacao">Pós-graduação</option>
                                </select>
                                <span asp-validation-for="Escolaridade" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="TrabalhaAtualmente" class="form-check-input" type="checkbox" id="TrabalhaAtualmente">
                                    <label class="form-check-label inscription-label" for="TrabalhaAtualmente">
                                        Trabalho atualmente
                                    </label>
                                </div>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label asp-for="RendaFamiliar" class="form-label fw-semibold inscription-label">Renda Familiar Mensal</label>
                                    <select asp-for="RendaFamiliar" class="form-select form-select-lg" required>
                                        <option value="" selected disabled>Selecione</option>
                                        <option value="Ate1Salario">Até 1 salário mínimo</option>
                                        <option value="De1a2Salarios">De 1 a 2 salários mínimos</option>
                                        <option value="De2a3Salarios">De 2 a 3 salários mínimos</option>
                                        <option value="De3a5Salarios">De 3 a 5 salários mínimos</option>
                                        <option value="Acima5Salarios">Acima de 5 salários mínimos</option>
                                    </select>
                                    <span asp-validation-for="RendaFamiliar" class="text-danger small"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="PessoasNoDomicilio" class="form-label fw-semibold inscription-label">Pessoas no Domicílio</label>
                                    <select asp-for="PessoasNoDomicilio" class="form-select form-select-lg" required>
                                        <option value="" selected disabled>Selecione</option>
                                        <option value="1">1 pessoa</option>
                                        <option value="2">2-3 pessoas</option>
                                        <option value="4">4-5 pessoas</option>
                                        <option value="6">5+ pessoas</option>
                                    </select>
                                    <span asp-validation-for="PessoasNoDomicilio" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="PossuiDeficiencia" class="form-check-input" type="checkbox" id="PossuiDeficiencia" onchange="toggleDeficienciaDescricao()">
                                    <label class="form-check-label inscription-label" for="PossuiDeficiencia">
                                        Possuo alguma deficiência
                                    </label>
                                </div>
                            </div>

                            <div id="descricao-deficiencia-container" class="mb-4 d-none">
                                <label asp-for="DescricaoDeficiencia" class="form-label fw-semibold inscription-label">Qual deficiência?</label>
                                <textarea asp-for="DescricaoDeficiencia" class="form-control" rows="3" placeholder="Descreva brevemente sua deficiência"></textarea>
                                <span asp-validation-for="DescricaoDeficiencia" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- PASSO 5: Curso & Disponibilidade -->
                        <div id="step-5" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Sobre o Curso</h4>

                            <div class="mb-4">
                                <label asp-for="CursoDesejado" class="form-label fw-semibold inscription-label">Curso Desejado</label>
                                <select asp-for="CursoDesejado" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione o curso de interesse</option>
                                    <option value="ProgramadorDeSistemas">Programador de Sistemas</option>
                                    <option value="AssistenteDeTI">Assistente de TI (Zona Oeste)</option>
                                </select>
                                <span asp-validation-for="CursoDesejado" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <label asp-for="TurnoPreferencial" class="form-label fw-semibold inscription-label">Turno Preferencial</label>
                                <select asp-for="TurnoPreferencial" class="form-select form-select-lg" required>
                                    <option value="" selected disabled>Selecione</option>
                                    <option value="Tarde">Tarde</option>
                                    <option value="Noite">Noite</option>
                                </select>
                                <span asp-validation-for="TurnoPreferencial" class="text-danger small"></span>
                            </div>

                            <div class="mb-4">
                                <div class="form-check form-switch">
                                    <input asp-for="JaEstudouAntes" class="form-check-input" type="checkbox" id="JaEstudouAntes">
                                    <label class="form-check-label inscription-label" for="JaEstudouAntes">
                                        Já estudei essa área antes
                                    </label>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="IndicadoPor" class="form-label fw-semibold inscription-label">Como conheceu o programa? (Opcional)</label>
                                <select asp-for="IndicadoPor" class="form-select form-select-lg" data-optional>
                                    <option value="">Selecione</option>
                                    <option value="Instagram">Instagram</option>
                                    <option value="Facebook">Facebook</option>
                                    <option value="WhatsApp">WhatsApp</option>
                                    <option value="Amigo">Indicação de amigo/familiar</option>
                                    <option value="Escola">Escola/Universidade</option>
                                    <option value="Google">Busca no Google</option>
                                    <option value="GerandoFalcoes">Site Gerando Falcões</option>
                                    <option value="Outro">Outro</option>
                                </select>
                                <span asp-validation-for="IndicadoPor" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- PASSO 6: Conectividade & Finalização -->
                        <div id="step-6" class="step-content d-none">
                            <h4 class="mb-4 fw-bold inscription-step-title">Conectividade & Finalização</h4>

                            <div class="p-4 inscription-info-box rounded-3 mb-4 border">
                                <p class="fw-semibold mb-3 inscription-label">Quais recursos você possui em casa?</p>

                                <div class="form-check form-switch mb-2">
                                    <input class="form-check-input" type="checkbox" asp-for="PossuiComputador" id="pcSwitch">
                                    <label class="form-check-label inscription-label" for="pcSwitch">Tenho Computador ou Notebook</label>
                                </div>

                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" asp-for="PossuiInternet" id="netSwitch">
                                    <label class="form-check-label inscription-label" for="netSwitch">Tenho Acesso à Internet</label>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="PerfilLinkedin" class="form-label fw-semibold inscription-label">LinkedIn (Opcional)</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-white inscription-input-addon"><i class="bi bi-linkedin text-primary"></i></span>
                                    <input asp-for="PerfilLinkedin" class="form-control form-control-lg" placeholder="https://linkedin.com/in/voce" data-optional />
                                </div>
                            </div>

                            <hr class="my-4">

                            <div class="form-check mb-3">
                                <input asp-for="ConcordaPrograma" class="form-check-input" type="checkbox" required id="ConcordaPrograma">
                                <label class="form-check-label small inscription-label" for="ConcordaPrograma">
                                    <strong>Declaro que li e aceito os termos do programa Transformese</strong> e que todas as informações prestadas aqui são verdadeiras.
                                </label>
                                <span asp-validation-for="ConcordaPrograma" class="text-danger small d-block"></span>
                            </div>

                            <div class="form-check mb-4">
                                <input asp-for="AceitaNovidades" class="form-check-input" type="checkbox" id="AceitaNovidades">
                                <label class="form-check-label small inscription-label" for="AceitaNovidades">
                                    Aceito receber novidades, informações sobre novos cursos e oportunidades por e-mail.
                                </label>
                            </div>

                            <div class="alert alert-info rounded-3">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                <strong>Quase lá!</strong> Revise suas informações e clique em "Finalizar Inscrição" para concluir.
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-5">
                            <button type="button" id="btn-prev" class="btn btn-outline-secondary px-4 fw-semibold d-none" onclick="changeStep(-1)">
                                <i class="bi bi-arrow-left me-2"></i> Voltar
                            </button>

                            <button type="button" id="btn-next" class="btn btn-dark px-5 fw-bold ms-auto" onclick="changeStep(1)">
                                Próximo <i class="bi bi-arrow-right ms-2"></i>
                            </button>

                            <button type="submit" id="btn-submit" class="btn btn-success px-5 fw-bold ms-auto d-none">
                                FINALIZAR INSCRIÇÃO <i class="bi bi-check-lg ms-2"></i>
                            </button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>